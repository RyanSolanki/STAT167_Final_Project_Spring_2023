---
title: "STAT167 Final Project - Spring 2023"
authors: "Ryan Solanki, Jake Merrill, Girum Yaye, Harrison Chow, Shuqiao Yu"
date: "2023/5/12"
output:
  html_document:
    toc: yes
    toc_depth: 3
  pdf_document:
    toc: yes
    toc_depth: 3
---

#STAT 167 Final Project - Spring 2023

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Loading the dataset of US car accident data
```{r}
library(tidyverse)
# Load subset of LA car accident data
la_accidents <- read_csv("LA_Accidents.csv")
head(la_accidents,5)
```
```{r}
library(CatEncoders)
updatedAccidents2 <- la_accidents[-5:-6]
updatedAccidents <- la_accidents[-5:-6]
lab_enc = LabelEncoder.fit(updatedAccidents$City)

updatedAccidents$City <- transform(lab_enc, updatedAccidents$City)

lab_enc = LabelEncoder.fit(updatedAccidents$Weather_Condition)

updatedAccidents$Weather_Condition <- transform(lab_enc, updatedAccidents$Weather_Condition)
(updatedAccidents)

#storage <- list()
#for(i in names(updatedAccidents)[-1]){
#  storage[[i]] <- summary(lm(Severity ~ get(i), updatedAccidents))
#}

#print(storage)
#mlr <- lm(Severity ~ ., updatedAccidents)
mlr <- lm(Severity ~ Start_Time + End_Time + `Visibility(mi)` + `Wind_Speed(mph)` + Weather_Condition + Junction + Railway + Station + Traffic_Signal, updatedAccidents)
summary(mlr)
#Start_Time, End_Time, `Visibility(mi)`, `Wind_Speed(mph)`, Weather_Condition, Junction, Railway, Station, Traffic_Signal
```

```{r}
updatedAccidents3 <- scale(updatedAccidents[-1:-3])
updatedAccidents3 <- cbind(updatedAccidents[1:3],updatedAccidents3)
#updatedAccidents3

mlr2 <- lm(Severity ~ Start_Time + End_Time + `Visibility(mi)` + `Wind_Speed(mph)` + Weather_Condition + Junction + Railway + Station + Traffic_Signal, updatedAccidents3)
summary(mlr2)
```

```{r}
plotData <- updatedAccidents2 %>% drop_na() %>% select(Severity, Weather_Condition) %>% group_by(Severity, Weather_Condition) %>% summarise(count = n()) %>% filter(count > 1000)
SeverityvsWeatherPlot <- ggplot(data = plotData) +
  geom_col(mapping = aes(x = Severity, y = count, fill = Weather_Condition), position = "dodge") +
  ggtitle("Weather Condition & Severity Plot") + xlab("Severity") + ylab("Severity Count") +
  geom_text(mapping = aes(x = Severity, y = count, fill = Weather_Condition, label = count),hjust = -.1, position = position_dodge(width = .9)) + coord_flip()
  
SeverityvsWeatherPlot
pdf(file="WeatherCond_Vs_Severity.pdf")
SeverityvsWeatherPlot
dev.off()
```




